<div><style type="text/css">.sheet .disabled{background:#eee;color:#777}.sheet .hl{border-bottom:2px solid #000}.sheet .name-field{white-space:normal;word-break:break-all}</style><script type="@plotdb/block">var mod;module.exports={pkg:{name:"@makeform/budget",extend:{name:"@makeform/common"},dependencies:[{name:"@plotdb/sheet"},{name:"@plotdb/sheet",type:"css"}],i18n:{en:{"單位":"unit"},"zh-TW":{unit:"單位"}}},init:function(t){return t.pubsub.fire("subinit",{mod:mod(t)})}};mod=function(t){var e,n,i,r,u,o,s;e=t.root,n=t.ctx,i=t.data,r=t.parent,u=t.t;o=n.sheet;s={total:0};return{init:function(){var r,n,f,a,c,d=this;this.on("change",function(t){t==null&&(t={});s.total=t.total||0;s.sheet.data(t.data)||[];return c.render("total")});r=(i.config||{}).fields||[];["total price"].filter(function(n){return!r.filter(function(t){return t.type===n}).length}).forEach(function(t){return r.push({name:t,type:t})});n=r.map(function(t){return t.type});f={};["name","unit price","quantity","total price"].map(function(t){return f[t]=n.indexOf(t)});a=r.map(function(t){return function(){switch(t.type){case"total price":if(~f["unit price"]&&~f["quantity"]){return"disabled"}else{return""}case"name":return"name-field";default:return""}}()});return c=new ldview({root:e,init:{sheet:function(t){var n,e,l;n=t.node,e=t.ctx;s.sheet=l=new o({root:n,slider:true,data:[r.map(function(t){return u(t.name)})],frozen:{row:1},size:{col:["250px"]},class:{row:["hl"]},cellcfg:function(t){var n,e,r;n=t.row,e=t.col,r=t.type;if(r==="readonly"){if(n===0){return true}if(a[e]==="disabled"){return true}return false}if(r==="class"){if(n===0){return"disabled"}return a[e]||""}}});return l.on("change",function(){var t,n,e,r,a,i,u,o;t=f["unit price"];n=f["quantity"];e=f["total price"];if(!(~t&&~n)){return}r=l.data();s.total=0;for(a=1,i=r.length;a<i;++a){u=a;o=r[u][t]!=null&&r[u][n]!=null?+r[u][t]*r[u][n]:"";o=o===""?"":o!=null&&!isNaN(o)?+o:0;r[u][e]=o;s.total+=o||0}l.data(r);c.render("total");return d.value({total:s.total,data:JSON.parse(JSON.stringify(r))})})}},text:{total:function(t){var n;n=t.node;return s.total||0},unit:function(t){var n;n=t.node;return u(d.mod.info.config.unit||"")}}})},render:function(){},isEmpty:function(t){return!(t&&t.data&&t.data.length&&t.data.filter(function(t){return t.length}).length)},isEqual:function(t,n){var e,r,a,i,u,o,l,f,c,d,s;e=[this.isEmpty(t),this.isEmpty(n)],r=e[0],a=e[1];if(r&&a){return true}if(r||a){return false}if(t.total!==n.total){return false}if(t.data.length!==n.data.length){return false}for(i=0,u=t.data.length;i<u;++i){o=i;e=[t.data[o],n.data[o]],l=e[0],f=e[1];if(l.length!==f.length){return false}for(c=0,d=l.length;c<d;++c){s=c;if(l[s]!==f[s]){return false}}}return true},content:function(t){return t}}};</script><div class="form-group has-tips manual" ld="base error-root" plug="widget" style="cursor:default"><div ld="display" data-display="block"><label class="d-flex align-items-end flex-wrap"><div><span ld="label"></span><span class="text-danger ml-2" ld="is-required">*</span></div><div class="flex-grow-1"></div><div class="m-edit"><div class="text-danger text-sm" ld="limitation"></div></div></label></div><div class="text-sm text-muted" ld="display" data-display="block"><div ld="desc" style="margin:-.6em 0 .7em"></div></div><div class="rounded shadow-sm border mb-2 aspect-ratio ratio-3by2 w-100" ld="sheet"></div><div class="d-flex g-2 align-items-end"><div>總金額:</div><div ld="total"></div><div class="text-sm text-muted" ld="unit"></div></div><div class="m-edit" ld="display" data-display="block"><div class="text-danger text-sm mt-2 note" ld-each="note"></div></div></div></div>
