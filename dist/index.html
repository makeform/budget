<div><style type="text/css">.sheet .disabled{background:#eee;color:#777}.sheet .hl{border-bottom:2px solid #000}.sheet .name-field{white-space:normal;word-break:break-all}[ld=total].text-danger:after{font-family:ldi;display:inline;content:"\f03d";font-size:.85em;margin-left:.5em}</style><script type="@plotdb/block">var mod;module.exports={pkg:{name:"@makeform/budget",extend:{name:"@makeform/common"},dependencies:[{name:"papaparse",path:"papaparse.min.js"},{name:"@plotdb/sheet"},{name:"@plotdb/sheet",type:"css"}],i18n:{en:{"單位":"unit","總金額":"Subtotal"},"zh-TW":{unit:"單位","總金額":"總金額"}}},init:function(t){return t.pubsub.fire("subinit",{mod:mod(t)})}};mod=function(t){var e,n,r,a,o,u,y;e=t.root,n=t.ctx,r=t.data,a=t.parent,o=t.t;u=n.sheet;y={total:0,mode:"edit"};return{init:function(){var p,a,n,m,i,h,g=this;this.on("change",function(t){var n;t==null&&(t={});y.total=t.total||0;n=JSON.parse(JSON.stringify(t.data))||[];n=[a.map(function(t){return o(t.name)})].concat(n);y._data=JSON.parse(JSON.stringify(n))||[];y.sheet.data(n);return h.render("total")});this.on("mode",function(t){y.mode=t;return y.sheet.render()});p=function(){var t;t=g.mod.info.config.meta||{};return y.mode==="view"||t.disabled||t.readonly};a=(this.mod.info.config||{}).fields||[];["total price"].filter(function(n){return!a.filter(function(t){return t.type===n}).length}).forEach(function(t){return a.push({name:t,type:t})});n=a.map(function(t){return t.type});m={};["name","unit price","quantity","total price"].map(function(t){return m[t]=n.indexOf(t)});i=a.map(function(t){return function(){switch(t.type){case"total price":if(~m["unit price"]&&~m["quantity"]){return"disabled"}else{return""}case"name":return"name-field";default:return""}}()});return h=new ldview({root:e,init:{sheet:function(t){var n,e,r,c;n=t.node,e=t.ctx;r=a.map(function(t){var n;n=t.width||"";if(t.type==="name"&&!n){n="250px"}return n});y.sheet=c=new u({root:n,slider:true,data:[a.map(function(t){return o(t.name)})],frozen:{row:1},size:{col:r},class:{row:["hl"]},cellcfg:function(t){var n,e,r;n=t.row,e=t.col,r=t.type;if(r==="readonly"){if(p()){return true}if(n===0){return true}if(i[e]==="disabled"){return true}return false}if(r==="class"){if(n===0){return"disabled"}return i[e]||""}}});return c.on("change",function(){var t,n,e,r,a,i,o,u,l,f,s;if(p()){return c.data(JSON.parse(JSON.stringify(y._data)))}t=m["unit price"];n=m["quantity"];e=m["total price"];r=c.data();y.total=0;if(!(~t&&~n)){for(a=1,i=r.length;a<i;++a){o=a;u=r[o][e]!=null&&!isNaN(r[o][e])?+r[o][e]:0;y.total+=u||0}}else{for(a=1,i=r.length;a<i;++a){o=a;l=[r[o][t],r[o][n]].map(d),f=l[0],s=l[1];u=f!==""&&s!==""?+f*+s:"";u=u===""?"":u!=null&&!isNaN(u)?+u:0;r[o][e]=u;y.total+=u||0}c.data(r)}r=JSON.parse(JSON.stringify(r));r.splice(0,1);g.value({total:y.total,data:r});return h.render("total");function d(t){return((t!=null?t:"")+"").trim()}})}},handler:{total:function(t){var n;n=t.node;return n.classList.toggle("text-danger",g.status()===2)}},text:{total:function(t){var n;n=t.node;return y.total||0},unit:function(t){var n;n=t.node;return o(g.mod.info.config.unit||"")}}})},render:function(){},isEmpty:function(t){return!(t&&t.data&&t.data.length&&t.data.filter(function(t){return t.length}).length)},isEqual:function(t,n){var e,r,a,i,o,u,l,f,s,d,c;e=[this.isEmpty(t),this.isEmpty(n)],r=e[0],a=e[1];if(r&&a){return true}if(r||a){return false}if(t.total!==n.total){return false}if(t.data.length!==n.data.length){return false}for(i=0,o=t.data.length;i<o;++i){u=i;e=[t.data[u],n.data[u]],l=e[0],f=e[1];if(l.length!==f.length){return false}for(s=0,d=l.length;s<d;++s){c=s;if(l[c]!==f[c]){return false}}}return true},content:function(t){return t}}};</script><div class="form-group has-tips manual" ld="base error-root" plug="widget" style="cursor:default"><div ld="display" data-display="block"><label class="d-flex align-items-end flex-wrap"><div><span ld="label"></span><span class="text-danger ml-2" ld="is-required">*</span></div><div class="flex-grow-1"></div><div class="m-edit"><div class="text-danger text-sm" ld="limitation"></div></div></label></div><div class="text-sm text-muted" ld="display" data-display="block"><div ld="desc" style="margin:-.6em 0 .7em"></div></div><div class="rounded shadow-sm border mb-2 aspect-ratio ratio-3by2 w-100" ld="sheet"></div><div class="d-flex g-2 align-items-end"><div><span t>總金額</span>:</div><div class="d-flex align-items-center" ld="total"></div><div class="text-sm text-muted" ld="unit"></div></div><div class="m-edit"><div class="hover-tip tip-sm"><div ld-each="error"></div></div></div><div class="m-edit" ld="display" data-display="block"><div class="text-danger text-sm mt-2 note" ld-each="note"></div></div></div></div>
